<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Signature - Interactive Learning</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #00ACC1; /* main blue */
            --secondary: #4DD0E1; /* lighter blue */
            --accent: #80DEEA; /* accent blue */
            --blue1: #B2EBF2;
            --blue2: #E0F7FA;
            --blue3: #F3FBFC;
            --text-main: #00323d; /* deep blue for contrast */
            --text-secondary: #006978; /* medium blue for secondary text */
            --bg-gradient: linear-gradient(135deg, var(--primary) 0%, var(--blue2) 100%);
            --section-bg: rgba(255,255,255,0.98);
            --header-bg: rgba(255,255,255,0.85);
            --footer-bg: linear-gradient(135deg, var(--primary) 0%, var(--blue2) 100%);
            --nav-bg: rgba(255,255,255,0.95);
            --nav-btn-bg: linear-gradient(90deg, var(--primary), var(--secondary));
            --nav-btn-active-bg: linear-gradient(90deg, var(--secondary), var(--accent));
            --transition: all 0.3s cubic-bezier(.4,2,.6,1);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
        }
        [data-theme="dark"] {
            --primary: #00ACC1;
            --secondary: #4DD0E1;
            --accent: #80DEEA;
            --blue1: #00323d;
            --blue2: #006978;
            --blue3: #222f3e;
            --text-main: #E0F7FA;
            --text-secondary: #B2EBF2;
            --bg-gradient: linear-gradient(135deg, #00323d 0%, #006978 100%);
            --section-bg: rgba(0, 50, 61, 0.98);
            --header-bg: rgba(0, 50, 61, 0.85);
            --footer-bg: linear-gradient(135deg, #00323d 0%, #006978 100%);
            --nav-bg: rgba(0, 50, 61, 0.95);
            --nav-btn-bg: linear-gradient(90deg, #00323d, #4DD0E1);
            --nav-btn-active-bg: linear-gradient(90deg, #4DD0E1, #00323d);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.25);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-main);
            background: var(--bg-gradient);
            min-height: 100vh;
            font-size: 16px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: var(--text-main);
            margin-bottom: 30px;
            padding: 40px 20px;
            background: var(--header-bg);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            padding-top: 60px;
        }

        .header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at top right, rgba(255,255,255,0.2) 0%, transparent 40%);
            pointer-events: none;
        }

        .header h1 {
            font-size: clamp(1.8em, 5vw, 2.5em);
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: clamp(1em, 2.5vw, 1.2em);
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
        }

        .download-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            margin: 10px 5px;
            transition: var(--transition);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .download-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        .navigation {
            background: var(--nav-bg);
            backdrop-filter: blur(10px);
            border-radius: 50px;
            padding: 15px;
            margin-bottom: 30px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .nav-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .nav-btn {
            background: var(--nav-btn-bg);
            color: var(--text-main);
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn:hover {
            background: var(--nav-btn-active-bg);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.12);
        }

        .nav-btn.active {
            background: var(--nav-btn-active-bg);
            color: var(--text-main);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.12);
        }

        .section {
            background: var(--blue1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
            position: relative;
            display: none;
        }
        .section.active {
            display: block;
        }

        /* White background for intro section in light mode */
        :root:not([data-theme="dark"]) #intro.section {
            background: #ffffff;
        }

        .section-title {
            color: var(--primary);
            font-size: clamp(1.4em, 4vw, 1.8em);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--secondary);
            display: flex;
            align-items: center;
            text-align: left;
        }

        img {
            max-width: 100%;
            height: auto;
            display: block;
            border-radius: 10px;
        }

        .image-placeholder {
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
            padding: 0;
            background: none;
            border: none;
        }
        
        .card-image img {
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .intro-image-float {
            float: right;
            max-width: 50%;
            margin: 0 0 20px 20px;
        }
        
        .intro-image-float.left {
            float: left;
            margin: 0 20px 20px 0;
        }
        
        .large-centered-image {
            max-width: 900px;
        }
        
        /* Enlarge RSA images */
        .rsa-section .image-placeholder {
             max-width: 900px; /* Increased size for visibility */
        }
        
        .intro-main-definition, #intro p {
            font-size: 1.1em;
            line-height: 1.8;
            margin-bottom: 20px;
            color: var(--text-main);
        }

        #intro h4 {
            font-size: 1.4em;
            margin-top: 30px;
            margin-bottom: 15px;
            color: var(--primary);
            border-bottom: 2px solid var(--blue1);
            padding-bottom: 5px;
        }

        #intro ol, #intro ul {
            list-style-position: outside;
            margin-left: 25px;
            margin-bottom: 20px;
        }

        #intro li {
            font-size: 1.05em;
            line-height: 1.7;
            margin-bottom: 12px;
        }

        #intro li strong {
            color: var(--primary);
        }

        #intro ul ul {
            margin-left: 20px;
            margin-top: 10px;
            list-style-type: disc;
        }

        #intro ul ul li {
            font-size: 0.95em;
            color: var(--text-secondary);
        }

        .attacks-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: var(--section-bg);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: block;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .attacks-table thead, .attacks-table tbody {
            display: table;
            width: 100%;
            min-width: 800px; /* Ensure table has a minimum width for scrolling */
            table-layout: fixed;
        }

        .attacks-table th {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
        }

        .attacks-table td {
            padding: 15px;
            border-bottom: 1px solid var(--blue1);
        }

        .attacks-table tr:hover {
            background-color: var(--blue2);
        }

        .threat-level {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: bold;
            display: inline-block;
        }

        .threat-low { background-color: #c8e6c9; color: #2e7d32; }
        .threat-moderate { background-color: #fff9c4; color: #fbc02d; }
        .threat-high { background-color: #ffccbc; color: #d84315; }
        .threat-critical { background-color: #ffcdd2; color: #c62828; }
        
        [data-theme="dark"] .threat-low { background-color: #2e7d32; color: #c8e6c9; }
        [data-theme="dark"] .threat-moderate { background-color: #fbc02d; color: #fff9c4; }
        [data-theme="dark"] .threat-high { background-color: #d84315; color: #ffccbc; }
        [data-theme="dark"] .threat-critical { background-color: #c62828; color: #ffcdd2; }

        .key-differences {
            background: var(--section-bg);
            border-left: 4px solid var(--primary);
            padding: 20px;
            margin: 25px 0;
            border-radius: 0 10px 10px 0;
            box-shadow: var(--shadow);
        }

        .key-differences h4 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .key-differences ol {
            margin-left: 20px;
        }

        .key-differences li {
            margin-bottom: 10px;
            line-height: 1.6;
        }
        
        .review-questions-list {
            display: flex;
            flex-direction: column;
            gap: 25px;
            padding: 10px;
        }

        .review-questions-controls {
            display: flex;
            justify-content: center;
            margin-bottom: 35px;
        }

        .toggle-all-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .toggle-all-btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }

        .toggle-all-btn .fa-eye-slash {
            display: none;
        }

        .toggle-all-btn.all-shown .fa-eye {
            display: none;
        }

        .toggle-all-btn.all-shown .fa-eye-slash {
            display: inline-block;
        }
        
        .question {
            background: var(--section-bg);
            padding: 25px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: all 0.4s ease;
            margin-bottom: 20px;
            border: 1px solid var(--blue1);
        }
        
        .question:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-color: var(--primary);
        }

        .question-title {
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0;
            font-size: 1.2em;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
        }
        
        .question-title .arrow-icon {
            font-size: 1.2em;
            transition: transform 0.4s ease;
            color: var(--primary);
        }

        .question.open .arrow-icon {
            transform: rotate(180deg);
        }

        .question-answer {
            color: var(--text-secondary);
            max-height: 0;
            overflow: hidden;
            padding: 0;
            margin: 0;
            border-top: 1px solid transparent;
            transition: all 0.5s ease-out;
            font-size: 1.1em;
            line-height: 1.8;
            opacity: 0;
            font-weight: 500;
        }

        .question.open .question-answer {
            max-height: 1000px;
            padding: 20px 0 10px 0;
            margin-top: 15px;
            border-top-color: var(--blue1);
            opacity: 1;
            color: var(--text-main);
            text-shadow: 0 0 1px rgba(0,0,0,0.1);
        }

        /* Light mode specific styles */
        [data-theme="light"] .question-answer {
            color: #2c3e50;
        }

        [data-theme="light"] .question.open .question-answer {
            color: #1a2530;
            text-shadow: 0 0 1px rgba(0,0,0,0.05);
        }

        /* Dark mode specific styles */
        [data-theme="dark"] .question-answer {
            color: #E0F7FA;
        }

        [data-theme="dark"] .question.open .question-answer {
            color: #FFFFFF;
            text-shadow: 0 0 1px rgba(255,255,255,0.1);
        }

        /* Enhance strong text in answers */
        .question-answer strong {
            color: var(--primary);
            font-weight: 600;
            text-shadow: none;
        }

        [data-theme="light"] .question-answer strong {
            color: #006064;
        }

        [data-theme="dark"] .question-answer strong {
            color: #4DD0E1;
        }

        /* Improve answer text readability */
        .question-answer p {
            margin-bottom: 15px;
            text-align: justify;
            letter-spacing: 0.3px;
        }

        /* Add subtle background to answers for better contrast */
        .question.open .question-answer {
            background: linear-gradient(
                to right,
                var(--section-bg),
                var(--blue3)
            );
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
        }

        [data-theme="light"] .question.open .question-answer {
            background: linear-gradient(
                to right,
                var(--section-bg),
                var(--blue2)
            );
        }

        [data-theme="dark"] .question.open .question-answer {
            background: linear-gradient(
                to right,
                var(--section-bg),
                var(--blue1)
            );
        }

        .highlight {
            background: linear-gradient(120deg, var(--secondary) 0%, var(--accent) 100%);
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
            color: var(--text-main);
        }

        .rsa-section {
            text-align: center;
            padding: 40px 30px;
            background: var(--blue2);
            border-radius: 20px;
            margin: 30px 0;
            box-shadow: var(--shadow);
        }

        .rsa-section h3 {
            font-size: clamp(1.8em, 4.5vw, 2.2em);
            margin-bottom: 25px;
            color: var(--primary);
        }

        .rsa-section p {
            font-size: 1.1em;
            line-height: 1.7;
            max-width: 800px;
            margin: 15px auto;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: var(--blue1);
            border-radius: 3px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.3s ease;
        }

        footer {
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            color: var(--text-main);
            font-size: 0.9em;
            background: var(--footer-bg);
            border-radius: 20px 20px 0 0;
        }
        
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        .theme-toggle {
            position: absolute;
            top: 15px;
            right: 20px;
            z-index: 10;
        }
        .toggle-switch {
            width: 56px;
            height: 28px;
            background: var(--blue1);
            border-radius: 20px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            transition: left 0.3s cubic-bezier(.4,2,.6,1), background 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1em;
            color: var(--primary);
            overflow: hidden;
        }
        .toggle-slider .icon-sun, .toggle-slider .icon-moon {
            position: absolute; opacity: 0; transition: opacity 0.3s;
        }
        .toggle-slider .icon-sun { color: #FFD700; }
        .toggle-slider .icon-moon { color: var(--primary); }
        .toggle-switch:not(.dark) .icon-sun { opacity: 1; }
        .toggle-switch.dark .icon-moon { opacity: 1; }
        .toggle-switch.dark { background: var(--primary); }
        .toggle-switch.dark .toggle-slider { left: 31px; background: var(--blue3); }
        
        .download-section-btn {
            background: var(--blue2);
            color: var(--text-main);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4em;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.2s;
            margin-left: auto;
            flex-shrink: 0;
        }
        .download-section-btn:hover {
            background: var(--blue3);
            transform: scale(1.1);
        }
        
        .screenshot-hide { display: none !important; }

        .copyright-btn {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-top: 15px;
        }
        .copyright-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .notification {
            position: fixed;
            bottom: 20px;
            left: -400px; /* Start off-screen */
            background: var(--section-bg);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            max-width: 380px;
            z-index: 1000;
            transition: left 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .notification.show {
            left: 20px;
        }

        .notification-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .notification-title { font-weight: bold; color: var(--primary); font-size: 1.2em; display: flex; align-items: center; gap: 10px; }
        .notification-close { background: none; border: none; color: var(--text-secondary); cursor: pointer; font-size: 1.5em; padding: 5px; transition: var(--transition); }
        .notification-close:hover { color: var(--primary); transform: rotate(90deg); }
        .notification-content { font-size: 0.95em; line-height: 1.7; }
        .notification-content p { margin-bottom: 10px; }
        .notification-content .disclaimer { font-style: italic; opacity: 0.8; font-size: 0.9em; margin-top: 10px; }
        
        @media (max-width: 480px) {
            .notification {
                max-width: calc(100% - 40px);
                left: -100%;
            }
            .notification.show {
                left: 20px;
            }
        }

        .nav-dropdown-container { display: none; width: 100%; padding: 0 10px; }
        .nav-dropdown {
            width: 100%; padding: 12px 20px; border-radius: 25px; border: 1px solid var(--blue1);
            background: var(--section-bg); color: var(--text-main); font-size: 1em; font-weight: 500;
            cursor: pointer; appearance: none; -webkit-appearance: none; -moz-appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg fill="currentColor" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>');
            background-repeat: no-repeat; background-position: right 15px center; background-size: 20px;
            box-shadow: var(--shadow); transition: var(--transition);
        }
        .nav-dropdown:hover { box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15); }
        
        .loading-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(224, 247, 250, 0.8); backdrop-filter: blur(10px);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 9999; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        [data-theme="dark"] .loading-screen { background: rgba(34, 47, 62, 0.8); }
        .loading-screen.show { opacity: 1; visibility: visible; }
        .loading-spinner {
            border: 8px solid rgba(255, 255, 255, 0.3); border-top: 8px solid var(--primary);
            border-radius: 50%; width: 60px; height: 60px; animation: spin 1s linear infinite; margin-bottom: 20px;
        }
        .loading-text { font-size: 1.2em; font-weight: bold; color: var(--text-main); text-shadow: 0 0 8px rgba(0,0,0,0.4); }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        @media (max-width: 768px) {
            .nav-buttons { display: none; }
            .nav-dropdown-container { display: block; }
            .navigation { padding: 10px; }
            .intro-image-float { float: none; max-width: 90%; margin: 20px auto; }
            .attacks-table { font-size: 0.9em; }
        }

        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            .header, .section {
                padding: 20px 15px;
            }
            .header h1 {
                font-size: clamp(1.5em, 6vw, 2em);
            }
            .download-btn {
                font-size: 1em;
                padding: 12px 24px;
            }
        }

        .intro-header {
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
        }

        .definition-card {
            background: var(--section-bg);
            padding: 30px;
            border-radius: 20px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 25px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .definition-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, transparent 100%);
            opacity: 0.05;
            transition: opacity 0.3s ease;
        }

        .definition-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }

        .definition-card:hover::before {
            opacity: 0.1;
        }

        .definition-icon {
            font-size: 3em;
            color: var(--primary);
            flex-shrink: 0;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
            transition: transform 0.3s ease;
        }

        .definition-card:hover .definition-icon {
            transform: scale(1.1);
        }

        .intro-content {
            display: grid;
            grid-template-columns: 1.2fr 0.8fr;
            gap: 40px;
            margin-top: 40px;
        }

        .feature-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .feature-card {
            background: var(--section-bg);
            padding: 25px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            border: 1px solid transparent;
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary);
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
            border-color: var(--primary);
        }

        .feature-card:hover::before {
            transform: scaleY(1);
        }

        .feature-card i {
            font-size: 2em;
            color: var(--primary);
            margin-bottom: 20px;
            transition: transform 0.3s ease;
        }

        .feature-card:hover i {
            transform: scale(1.1) rotate(5deg);
        }

        .feature-card h4 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.3em;
            transition: color 0.3s ease;
        }

        .feature-card p {
            color: var(--text-secondary);
            line-height: 1.7;
            transition: color 0.3s ease;
        }

        .important-notes {
            margin-top: 40px;
            background: var(--section-bg);
            padding: 30px;
            border-radius: 20px;
            box-shadow: var(--shadow);
        }

        .important-notes h4 {
            display: flex;
            align-items: center;
            gap: 15px;
            color: var(--primary);
            margin-bottom: 25px;
            font-size: 1.4em;
        }

        .important-notes h4 i {
            font-size: 1.2em;
            color: var(--primary);
        }

        .note-cards {
            display: grid;
            gap: 25px;
        }

        .note-card {
            background: var(--section-bg);
            padding: 25px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .note-card::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, var(--primary) 0%, transparent 100%);
            opacity: 0.05;
            transition: opacity 0.3s ease;
        }

        .note-card:hover {
            transform: translateX(5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .note-card:hover::after {
            opacity: 0.1;
        }

        .note-card h5 {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .note-card h5 i {
            font-size: 1.2em;
        }

        .note-card p {
            color: var(--text-secondary);
            line-height: 1.8;
            text-align: justify;
        }

        .intro-right {
            position: relative;
        }

        .intro-right .image-placeholder {
            margin-bottom: 30px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .intro-right .image-placeholder:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
        }

        .intro-right .card-image img {
            width: 100%;
            height: auto;
            display: block;
            transition: transform 0.3s ease;
        }

        .intro-right .image-placeholder:hover .card-image img {
            transform: scale(1.05);
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .intro-content {
                grid-template-columns: 1fr;
                gap: 30px;
            }

            .intro-right {
                order: -1;
            }

            .intro-right .image-placeholder {
                max-width: 800px;
                margin: 0 auto 30px;
            }
        }

        @media (max-width: 768px) {
            .definition-card {
                flex-direction: column;
                text-align: center;
                padding: 25px;
            }

            .definition-icon {
                margin-bottom: 15px;
            }

            .feature-cards {
                grid-template-columns: 1fr;
            }

            .important-notes {
                padding: 20px;
            }

            .note-card {
                padding: 20px;
            }
        }

        @media (max-width: 480px) {
            .intro-header {
                margin-bottom: 30px;
            }

            .definition-card {
                padding: 20px;
            }

            .feature-card {
                padding: 20px;
            }

            .important-notes {
                padding: 15px;
            }

            .note-card {
                padding: 15px;
            }

            .intro-right .image-placeholder {
                margin-bottom: 20px;
            }
        }

        /* Animation for content appearance */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .definition-card,
        .feature-card,
        .note-card {
            animation: fadeInUp 0.6s ease-out forwards;
        }

        .feature-card:nth-child(2) {
            animation-delay: 0.2s;
        }

        .feature-card:nth-child(3) {
            animation-delay: 0.4s;
        }

        .note-card:nth-child(2) {
            animation-delay: 0.2s;
        }

        /* Update Introduction Section Styles */
        .intro-main-definition {
            font-size: 1.2em;
            line-height: 1.8;
            margin-bottom: 30px;
            color: var(--text-main);
        }

        #intro h4 {
            font-size: 1.5em;
            margin-top: 30px;
            margin-bottom: 15px;
            color: var(--primary);
            border-bottom: 2px solid var(--blue1);
            padding-bottom: 5px;
        }

        #intro ol, #intro ul {
            list-style-position: outside;
            margin-left: 25px;
            margin-bottom: 20px;
        }

        #intro li {
            font-size: 1.05em;
            line-height: 1.7;
            margin-bottom: 12px;
        }

        #intro li strong {
            color: var(--primary);
        }

        #intro ul ul {
            margin-left: 20px;
            margin-top: 8px;
            list-style-type: disc;
        }

        #intro ul ul li {
            font-size: 0.95em;
            line-height: 1.6;
            margin-bottom: 8px;
            color: var(--text-secondary);
        }

        .intro-image-float {
            float: right;
            max-width: 50%;
            margin: 0 0 20px 20px;
        }

        .intro-image-float.left {
            float: left;
            margin: 0 20px 20px 0;
        }

        .large-centered-image {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px auto;
        }

        .card-image img {
            max-width: 100%;
            height: auto;
            object-fit: contain;
            display: block;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        @media (max-width: 900px) {
            .intro-image-float {
                max-width: 100%;
                float: none;
                margin: 20px auto;
            }
        }

    </style>
</head>
<body>
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-spinner"></div>
        <p class="loading-text">Preparing your download...</p>
    </div>

    <div class="container">
        <div class="header">
            <div class="theme-toggle">
                <div class="toggle-switch" id="themeSwitch">
                    <div class="toggle-slider">
                        <span class="icon-sun"><i class="fas fa-sun"></i></span>
                        <span class="icon-moon"><i class="fas fa-moon"></i></span>
                    </div>
                </div>
            </div>
            <h1><i class="fas fa-signature"></i> Data Security Learning Module</h1>
            <p>Digital Signatures</p>
            <p>Created By Eng. Eslam Osama</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>
            <div class="download-buttons">
                <button class="download-btn" onclick="downloadOriginalSheet()">
                    <i class="fas fa-file-pdf"></i> Download Original Sheet
                </button>
                <button class="download-btn" onclick="downloadFullPageZip()">
                    <i class="fas fa-file-zipper"></i> Download Content (ZIP)
                </button>
            </div>
        </div>

        <div class="navigation">
            <div class="nav-buttons">
                <button class="nav-btn active" data-section="intro">
                    <i class="fas fa-book-open"></i> Introduction
                </button>
                <button class="nav-btn" data-section="attacks">
                    <i class="fas fa-shield-virus"></i> Attacks & Forgeries
                </button>
                <button class="nav-btn" data-section="differences">
                    <i class="fas fa-exchange-alt"></i> Key Differences
                </button>
                <button class="nav-btn" data-section="forgery-types">
                    <i class="fas fa-mask"></i> Forgery Types
                </button>
                <button class="nav-btn" data-section="rsa">
                    <i class="fas fa-key"></i> RSA Scheme
                </button>
                <button class="nav-btn" data-section="questions">
                    <i class="fas fa-question-circle"></i> Review Questions
                </button>
            </div>
            <div class="nav-dropdown-container">
                <select id="navDropdown" class="nav-dropdown">
                    <option value="intro">Introduction</option>
                    <option value="attacks">Attacks & Forgeries</option>
                    <option value="differences">Key Differences</option>
                    <option value="forgery-types">Forgery Types</option>
                    <option value="rsa">RSA Scheme</option>
                    <option value="questions">Review Questions</option>
                </select>
            </div>
        </div>

        <div id="intro" class="section active">
            <h2 class="section-title">
                <span></i> Introduction to Digital Signatures</span>
                <button class="download-section-btn" onclick="downloadSectionPng(this)"><i class="fas fa-download"></i></button>
            </h2>
            <p class="intro-main-definition"><strong>Digital Signature</strong> is a cryptographic technique that verifies the <span class="highlight">authenticity</span>, <span class="highlight">integrity</span>, and <span class="highlight">origin</span> of a digital message or document. It is created using the sender's <span class="highlight">private key</span> and verified using their <span class="highlight">public key</span>.</p>
            
            <div class="image-placeholder intro-image-float">
                <div class="card-image">
                    <img src="media/image1.png" alt="Simplified Depiction of Digital Signature Process">
                </div>
            </div>

            <h4>Key Features of Digital Signatures</h4>
            <ol>
                <li><strong>Authenticity:</strong> Confirms the message is from the claimed sender (verified via public key).</li>
                <li><strong>Integrity:</strong> Ensures the message hasn't been altered; any change breaks the signature.</li>
                <li><strong>Non-repudiation:</strong> The sender cannot deny sending the message after signing it.</li>
            </ol>

            <h4>Important Notes:</h4>
            <ul>
                <li><strong>Third-Party Authentication in Digital Signatures</strong><br>
                    A digital signature must be publicly verifiable, meaning a trusted third party can check its validity — not just the sender and receiver. This is often done using a Certificate Authority (CA).
                </li>
                <li><strong>Signatures Are Not Unconditionally Secure</strong><br>
                    Digital signatures are not 100% secure. An attacker might eventually break the algorithm, exploit weak random number generators, or use forgery attacks. Expiration dates help reduce this risk over time.
                </li>
            </ul>

            <div class="image-placeholder large-centered-image">
                <div class="card-image">
                    <img src="media/image2.png" alt="Obtaining certificates from Certificate Authority">
                </div>
            </div>
            <div style="clear: both;"></div>
        </div>

        <div id="attacks" class="section">
            <h2 class="section-title">Attacks and Forgeries
                <button class="download-section-btn" onclick="downloadSectionPng(this)"><i class="fas fa-download"></i></button>
            </h2>
            <p><strong>Scenario:</strong> Assume <span class="highlight">Alice is a server that runs an automated document-signing service</span>. An attacker (Mallory) wants to forge her signature.</p>
            
            <table class="attacks-table">
                <thead>
                    <tr>
                        <th>Attack Type</th>
                        <th>What the Attacker Does</th>
                        <th>Example with Alice</th>
                        <th>Threat Level</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Key-only Attack</strong></td>
                        <td>Tries to forge a signature knowing only Alice's <strong>public key</strong>.</td>
                        <td>Mallory downloads Alice's public key and tries to create fake signed documents.</td>
                        <td><span class="threat-level threat-low">Low</span></td>
                    </tr>
                    <tr>
                        <td><strong>Known Message Attack</strong></td>
                        <td>Uses a set of <strong>valid signed documents</strong> to help forge a new one.</td>
                        <td>Mallory collects Alice's old signed contracts and studies the signatures to learn patterns.</td>
                        <td><span class="threat-level threat-moderate">Moderate</span></td>
                    </tr>
                    <tr>
                        <td><strong>Generic Chosen Message Attack</strong></td>
                        <td>Gets signatures on a <strong>pre-made list of messages</strong> to break the system.</td>
                        <td>Mallory sends 100 prepared contracts to Alice's API to be signed to find weaknesses.</td>
                        <td><span class="threat-level threat-moderate">Moderate</span></td>
                    </tr>
                    <tr>
                        <td><strong>Directed Chosen Message Attack</strong></td>
                        <td>Chooses messages to be signed <strong>after seeing the public key</strong> to target it.</td>
                        <td>After getting Alice's key, Mallory designs 100 specific contracts tailored to exploit it.</td>
                        <td><span class="threat-level threat-high">High</span></td>
                    </tr>
                    <tr>
                        <td><strong>Adaptive Chosen Message Attack</strong></td>
                        <td>Sends messages one by one, <strong>adapting each new message</strong> based on the last signature.</td>
                        <td>Mallory sends 1 contract, sees signature, then sends an adjusted one to extract info and forge.</td>
                        <td><span class="threat-level threat-critical">Critical</span></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div id="differences" class="section">
            <h2 class="section-title">Key Differences Between Attack Types
                 <button class="download-section-btn" onclick="downloadSectionPng(this)"><i class="fas fa-download"></i></button>
            </h2>
            
            <div class="key-differences">
                <h4>🔍 Generic Chosen Message vs. Known Message Attack</h4>
                <ol>
                    <li>In <strong>Generic</strong>, the attacker chooses the messages. In <strong>Known</strong>, the attacker only observes messages chosen by others.</li>
                    <li>In <strong>Generic</strong>, the attacker interacts with the signer. In <strong>Known</strong>, it's passive observation.</li>
                </ol>
            </div>

            <div class="key-differences">
                <h4>🎯 Generic vs. Directed Chosen Message Attack</h4>
                <ol>
                    <li>In <strong>Generic</strong>, messages are chosen *before* knowing the public key. In <strong>Directed</strong>, they're chosen *after* to specifically target the key.</li>
                </ol>
            </div>

            <div class="key-differences">
                <h4>🔄 Adaptive vs. Directed Chosen Message Attack</h4>
                <ol>
                    <li>In <strong>Directed</strong>, all messages are chosen at once. In <strong>Adaptive</strong>, the attacker learns from each signature and adjusts the next message, making it a dynamic, interactive attack.</li>
                </ol>
            </div>
        </div>

        <div id="forgery-types" class="section">
            <h2 class="section-title">Forgery Types
                 <button class="download-section-btn" onclick="downloadSectionPng(this)"><i class="fas fa-download"></i></button>
            </h2>
            <table class="attacks-table">
                <thead>
                    <tr>
                        <th>Forgery Type</th>
                        <th>What It Means</th>
                        <th>Threat Level</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Total Break</strong></td>
                        <td>Attacker recovers the signer's private key. They can sign anything.</td>
                        <td><span class="threat-level threat-critical">Catastrophic</span></td>
                    </tr>
                    <tr>
                        <td><strong>Universal Forgery</strong></td>
                        <td>Attacker can forge a signature for any message without the key (finds an algorithm flaw).</td>
                        <td><span class="threat-level threat-critical">Critical</span></td>
                    </tr>
                    <tr>
                        <td><strong>Selective Forgery</strong></td>
                        <td>Attacker forges a signature for a *specific, pre-chosen* message.</td>
                        <td><span class="threat-level threat-high">High</span></td>
                    </tr>
                    <tr>
                        <td><strong>Existential Forgery</strong></td>
                        <td>Attacker forges a signature for at least one message they didn't get to choose (often a nonsensical one).</td>
                        <td><span class="threat-level threat-low">Low (but still a break)</span></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div id="rsa" class="section">
             <h2 class="section-title">RSA Signature Scheme
                 <button class="download-section-btn" onclick="downloadSectionPng(this)"><i class="fas fa-download"></i></button>
            </h2>
            <div class="rsa-section">
                <h3>Direct Digital Signature with RSA</h3>
                <div class="image-placeholder">
                    <img src="media/image3.png" alt="RSA Digital Signature Process Diagram">
                </div>
                <p>The RSA algorithm can be used to create a direct digital signature, where the sender signs a message with their private key, and the receiver verifies it with the sender's public key.</p>
                
                <h3>Adding Confidentiality</h3>
                <div class="image-placeholder">
                    <img src="media/image4.png" alt="RSA Signature Implementation with Confidentiality">
                </div>
                 <p>For confidentiality, the entire signed message can be encrypted using a symmetric key shared between the sender and receiver. This protects both the message content and the signature from eavesdropping.</p>
            </div>
        </div>

        <div id="questions" class="section">
             <h2 class="section-title">Review Questions
                 <button class="download-section-btn" onclick="downloadSectionPng(this)"><i class="fas fa-download"></i></button>
            </h2>
             <div class="review-questions-controls">
                <button id="toggleAllAnswersBtn" class="toggle-all-btn">
                    <i class="fas fa-eye"></i>
                    <i class="fas fa-eye-slash"></i>
                    <span class="btn-text">Show All Answers</span>
                </button>
            </div>
            <div class="review-questions-list">
                <div class="question" data-toggle="q1">
                    <div class="question-title">(1) List two disputes that can arise in message authentication. <i class="fas fa-chevron-down arrow-icon"></i></div>
                    <div class="question-answer">
                        A sender might deny sending a message. A receiver might forge a message and claim it came from the sender.
                    </div>
                </div>
                <div class="question" data-toggle="q2">
                    <div class="question-title">(2) What are the properties a digital signature should have? <i class="fas fa-chevron-down arrow-icon"></i></div>
                    <div class="question-answer">
                        It must verify the author and the date/time of the signature. It must authenticate the contents at the time of signing. It must be verifiable by third parties to resolve disputes.
                    </div>
                </div>
                <div class="question" data-toggle="q3">
                    <div class="question-title">(3) What requirements should a digital signature scheme satisfy? <i class="fas fa-chevron-down arrow-icon"></i></div>
                    <div class="question-answer">
                        The signature must be a bit pattern depending on the message being signed. It must use information unique to the sender. It must be easy to produce, easy to recognize/verify, and computationally infeasible to forge.
                    </div>
                </div>
                <div class="question" data-toggle="q4">
                    <div class="question-title">(4) What is the difference between direct and arbitrated digital signatures? <i class="fas fa-chevron-down arrow-icon"></i></div>
                    <div class="question-answer">
                        <strong>Direct:</strong> Involves only the sender and receiver. The receiver verifies the signature with the sender's public key.
                        <strong>Arbitrated:</strong> Involves a trusted third party (an arbiter) who participates in the signature process to validate it.
                    </div>
                </div>
                <div class="question" data-toggle="q5">
                    <div class="question-title">(5) In what order should signing and encryption be applied? <i class="fas fa-chevron-down arrow-icon"></i></div>
                    <div class="question-answer">
                        Sign first, then encrypt. This ensures the signature is protected along with the message and allows the receiver to decrypt and then verify the signature on the original content.
                    </div>
                </div>
                <div class="question" data-toggle="q6">
                    <div class="question-title">(6) What are some threats to a direct digital signature scheme? <i class="fas fa-chevron-down arrow-icon"></i></div>
                    <div class="question-answer">
                        The main threat is forgery. An attacker might try to forge a signature using the public key (key-only attack) or by analyzing existing signed messages (known message attack). The sender could also later disown a signature by claiming their private key was lost or stolen.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <p>Data Security Learning Module - Digital Signatures | Created for Educational Purposes | By Eng. Eslam Osama</p>
            <button class="copyright-btn" onclick="showCopyrightNotice()">
                <i class="fas fa-copyright"></i> All Rights Reserved
            </button>
        </div>
    </footer>

    <div class="notification" id="copyrightNotification">
        <div class="notification-header">
            <div class="notification-title"><i class="fas fa-shield-alt"></i> Copyright Notice</div>
            <button class="notification-close" onclick="hideCopyrightNotice()"><i class="fas fa-times"></i></button>
        </div>
        <div class="notification-content">
            <p>This content is protected by copyright law. Unauthorized copying, distribution, or use of this material is strictly prohibited. The code, design, and content of this educational module are the exclusive property of the creator. Any reproduction or distribution without express written permission is a violation of copyright law.</p>
            <p class="disclaimer">This module is provided for educational purposes only. The creator makes no warranties about the completeness, reliability, or accuracy of this information.</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const themeSwitch = document.getElementById('themeSwitch');
            const root = document.documentElement;
            const progressBar = document.getElementById('progressBar');
            const navButtons = document.querySelectorAll('.nav-btn');
            const navDropdown = document.getElementById('navDropdown');
            const sections = document.querySelectorAll('.section');
            const questions = document.querySelectorAll('.question');
            const toggleAllBtn = document.getElementById('toggleAllAnswersBtn');
            const toggleAllBtnText = toggleAllBtn.querySelector('.btn-text');
            
            // --- Theme Toggle ---
            function setTheme(mode) {
                if (mode === 'dark') {
                    root.setAttribute('data-theme', 'dark');
                    themeSwitch.classList.add('dark');
                } else {
                    root.removeAttribute('data-theme');
                    themeSwitch.classList.remove('dark');
                }
                localStorage.setItem('theme', mode);
            }
            themeSwitch.addEventListener('click', () => {
                const isDark = root.hasAttribute('data-theme');
                setTheme(isDark ? 'light' : 'dark');
            });
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                setTheme(savedTheme);
            } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                setTheme('dark');
            }

            // --- Progress Bar & Nav on Scroll ---
            function onScroll() {
                // Progress Bar
                const scrollableHeight = document.documentElement.scrollHeight - window.innerHeight;
                const progress = scrollableHeight > 0 ? (window.scrollY / scrollableHeight) * 100 : 0;
                progressBar.style.width = progress + '%';

                // Active Nav Button based on scroll position
                let currentSection = '';
                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    if (window.scrollY >= sectionTop - 150) { // 150px offset for better UX
                        currentSection = section.id;
                    }
                });

                navButtons.forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.section === currentSection);
                });
                if(navDropdown.value !== currentSection && currentSection) {
                    navDropdown.value = currentSection;
                }
            }

            // --- Section Navigation ---
            function showSection(sectionId) {
                // 1. Update the active state of the main section content
                sections.forEach(s => s.classList.remove('active'));
                const activeSection = document.getElementById(sectionId);
                if (activeSection) {
                    activeSection.classList.add('active');
                }

                // 2. Scroll the relevant section into view
                if (activeSection) {
                    activeSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }

            // --- Event Listeners for Navigation ---
            navButtons.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    // When a button is clicked, we show the corresponding section.
                    // The onScroll event will handle updating the active button state.
                    showSection(btn.dataset.section);
                });
            });
            
            navDropdown.addEventListener('change', () => {
                 showSection(navDropdown.value);
            });


            // --- Accordion/Question Toggle ---
            questions.forEach(question => {
                question.addEventListener('click', () => {
                    question.classList.toggle('open');
                });
            });

            // --- Show/Hide All Answers ---
             toggleAllBtn.addEventListener('click', () => {
                const isAllShown = toggleAllBtn.classList.contains('all-shown');
                if (isAllShown) {
                    // Hide all
                    questions.forEach(q => q.classList.remove('open'));
                    toggleAllBtn.classList.remove('all-shown');
                    toggleAllBtnText.textContent = 'Show All Answers';
                } else {
                    // Show all
                    questions.forEach(q => q.classList.add('open'));
                    toggleAllBtn.classList.add('all-shown');
                    toggleAllBtnText.textContent = 'Hide All Answers';
                }
            });


            // --- Initial State ---
            // Show the intro section by default
            const initialSection = document.getElementById('intro');
            if(initialSection) initialSection.classList.add('active');
            onScroll(); // Set initial active button state

            // --- Main Event Listeners ---
            window.addEventListener('scroll', onScroll);
        });

        // --- Copyright Notice ---
        function showCopyrightNotice() {
            const notification = document.getElementById('copyrightNotification');
            notification.classList.add('show');
            setTimeout(() => {
                if (notification.classList.contains('show')) {
                    hideCopyrightNotice();
                }
            }, 5000); // Auto-hide after 5 seconds
        }
        function hideCopyrightNotice() {
            document.getElementById('copyrightNotification').classList.remove('show');
        }
        document.querySelector('.copyright-btn').addEventListener('click', (e) => {
            e.preventDefault();
            showCopyrightNotice();
        });
        document.querySelector('.notification-close').addEventListener('click', hideCopyrightNotice);
        setTimeout(showCopyrightNotice, 1500);

        // --- Download Functionality ---
        const loadingScreen = document.getElementById('loadingScreen');
        function showLoading(message) {
            loadingScreen.querySelector('.loading-text').textContent = message;
            loadingScreen.classList.add('show');
        }
        function hideLoading() {
            loadingScreen.classList.remove('show');
        }
        
        function downloadOriginalSheet() {
             window.open('assets/Digital_Sign_Sheet_9.pdf', '_blank');
        }

        async function prepareForCanvas(section) {
            // Hide all download buttons and navigation
            document.querySelectorAll('.download-section-btn, .download-btn, .navigation').forEach(el => el.classList.add('screenshot-hide'));
            
            // Open all questions within the target section
            section.querySelectorAll('.question').forEach(q => q.classList.add('open'));
            
            // Wait for animations to complete and ensure content is fully expanded
            await new Promise(r => setTimeout(r, 1200)); // Increased timeout for full expansion
            
            // Force multiple reflows to ensure all content is rendered
            section.offsetHeight;
            section.offsetHeight;
            
            // Additional check for question answers
            const questions = section.querySelectorAll('.question');
            for (const question of questions) {
                const answer = question.querySelector('.question-answer');
                if (answer) {
                    // Force the answer to be fully expanded
                    answer.style.maxHeight = 'none';
                    answer.style.opacity = '1';
                    answer.style.visibility = 'visible';
                }
            }
            
            // Final wait to ensure all styles are applied
            await new Promise(r => setTimeout(r, 300));
        }
        
        function cleanupAfterCanvas() {
            // Restore original styles for all questions
            document.querySelectorAll('.question').forEach(q => {
                const answer = q.querySelector('.question-answer');
                if (answer) {
                    answer.style.maxHeight = '';
                    answer.style.opacity = '';
                    answer.style.visibility = '';
                }
            });
            
            document.querySelectorAll('.screenshot-hide').forEach(el => el.classList.remove('screenshot-hide'));
            document.querySelectorAll('.question').forEach(q => q.classList.remove('open'));
        }

        async function downloadSectionPng(buttonEl) {
            const section = buttonEl.closest('.section');
            if (!section) return;

            showLoading('Preparing section image...');
            
            try {
                await prepareForCanvas(section);
                
                const canvas = await html2canvas(section, {
                    scale: 2,
                    useCORS: true,
                    backgroundColor: getComputedStyle(document.body).getPropertyValue('background-color'),
                    logging: false,
                    onclone: (clonedDoc) => {
                        // Ensure all answers are visible in the cloned document
                        const clonedSection = clonedDoc.querySelector(`#${section.id}`);
                        if (clonedSection) {
                            clonedSection.querySelectorAll('.question').forEach(q => {
                                q.classList.add('open');
                                const answer = q.querySelector('.question-answer');
                                if (answer) {
                                    answer.style.maxHeight = 'none';
                                    answer.style.opacity = '1';
                                    answer.style.visibility = 'visible';
                                }
                            });
                        }
                    }
                });

                const link = document.createElement('a');
                link.download = `${section.id}-section.jpeg`;
                link.href = canvas.toDataURL('image/jpeg', 0.9);
                link.click();
            } catch (err) {
                console.error("Failed to generate section image:", err);
                alert("Sorry, there was an error creating the image.");
            } finally {
                cleanupAfterCanvas();
                hideLoading();
            }
        }
        
        async function downloadFullPageZip() {
            showLoading('Creating ZIP file...');
            
            const zip = new JSZip();
            const sections = document.querySelectorAll('.section');

            for (const section of sections) {
                try {
                    const originalDisplay = section.style.display;
                    const wasActive = section.classList.contains('active');
                    section.style.display = 'block'; // Make sure it's rendered
                    section.classList.add('active');

                    await prepareForCanvas(section);
                    
                    const canvas = await html2canvas(section, {
                        scale: 2,
                        useCORS: true,
                        backgroundColor: getComputedStyle(document.body).getPropertyValue('background-color'),
                        logging: false,
                    });
                    const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg', 0.9));
                    zip.file(`${section.id}.jpeg`, blob);

                    section.style.display = originalDisplay;
                    if (!wasActive) {
                        section.classList.remove('active');
                    }

                } catch (err) {
                    console.error(`Failed to capture section ${section.id}:`, err);
                }
            }
            
            try {
                const zipBlob = await zip.generateAsync({ type: 'blob' });
                saveAs(zipBlob, 'Digital-Signature-Module.zip');
            } catch (err) {
                console.error("Failed to generate ZIP:", err);
                alert("Sorry, there was an error creating the ZIP file.");
            } finally {
                cleanupAfterCanvas();
                const activeNav = document.querySelector('.nav-btn.active') || document.querySelector('.nav-btn');
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                if(activeNav) {
                    const activeSection = document.getElementById(activeNav.dataset.section);
                    if(activeSection) activeSection.classList.add('active');
                }
                hideLoading();
            }
        }
    </script>
</body>
</html>
