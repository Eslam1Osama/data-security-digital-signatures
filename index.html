<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Signature - Interactive Learning</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #00ACC1; /* main blue */
            --secondary: #4DD0E1; /* lighter blue */
            --accent: #80DEEA; /* accent blue */
            --blue1: #B2EBF2;
            --blue2: #E0F7FA;
            --blue3: #F3FBFC;
            --text-main: #00323d; /* deep blue for contrast */
            --text-secondary: #006978; /* medium blue for secondary text */
            --bg-gradient: linear-gradient(135deg, var(--primary) 0%, var(--blue2) 100%);
            --section-bg: rgba(255,255,255,0.98);
            --header-bg: rgba(255,255,255,0.85);
            --footer-bg: linear-gradient(135deg, var(--primary) 0%, var(--blue2) 100%);
            --nav-bg: rgba(255,255,255,0.95);
            --nav-btn-bg: linear-gradient(90deg, var(--primary), var(--secondary));
            --nav-btn-active-bg: linear-gradient(90deg, var(--secondary), var(--accent));
            --transition: all 0.3s cubic-bezier(.4,2,.6,1);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
        }
        [data-theme="dark"] {
            --primary: #00ACC1;
            --secondary: #4DD0E1;
            --accent: #80DEEA;
            --blue1: #00323d;
            --blue2: #006978;
            --blue3: #222f3e;
            --text-main: #E0F7FA;
            --text-secondary: #B2EBF2;
            --bg-gradient: linear-gradient(135deg, #00323d 0%, #006978 100%);
            --section-bg: rgba(0, 50, 61, 0.98);
            --header-bg: rgba(0, 50, 61, 0.85);
            --footer-bg: linear-gradient(135deg, #00323d 0%, #006978 100%);
            --nav-bg: rgba(0, 50, 61, 0.95);
            --nav-btn-bg: linear-gradient(90deg, #00323d, #4DD0E1);
            --nav-btn-active-bg: linear-gradient(90deg, #4DD0E1, #00323d);
            --transition: all 0.3s cubic-bezier(.4,2,.6,1);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.25);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-main);
            background: var(--bg-gradient);
            min-height: 100vh;
            font-size: 16px; /* Base font size */
        }
        
        body.screenshot-mode {
            background: white !important;
        }
        [data-theme="dark"] body.screenshot-mode {
            background: #001f26 !important;
        }


        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: var(--text-main);
            margin-bottom: 30px;
            padding: 40px 20px;
            background: var(--header-bg);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            padding-top: 60px;
        }

        .header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at top right, rgba(255,255,255,0.2) 0%, transparent 40%);
            pointer-events: none;
        }

        .header h1 {
            font-size: clamp(1.8em, 5vw, 2.5em);
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: clamp(1em, 2.5vw, 1.2em);
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
        }

        .download-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            margin: 10px 5px;
            transition: var(--transition);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .download-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        .navigation {
            background: var(--nav-bg);
            backdrop-filter: blur(10px);
            border-radius: 50px;
            padding: 15px;
            margin-bottom: 30px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .nav-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .nav-btn {
            background: var(--nav-btn-bg);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn:hover, .nav-btn.active {
            background: var(--nav-btn-active-bg);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.12);
        }
        
        .section {
            background: var(--section-bg);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            display: none; /* Hidden by default, shown by JS */
            animation: fadeIn 0.5s ease-in-out;
        }

        .screenshot-mode .section {
             background: var(--section-bg) !important;
             backdrop-filter: none !important;
        }
        [data-theme="dark"] .screenshot-mode .section {
             background: var(--blue1) !important;
        }


        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            color: var(--primary);
            font-size: clamp(1.4em, 4vw, 1.8em);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--secondary);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .image-placeholder {
            width: 100%;
            max-width: 800px;
            min-height: unset;
            background: none;
            border: none;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px auto;
            padding: 0;
        }

        .intro-image-float {
            float: right;
            max-width: 50%;
            margin: 0 0 20px 20px;
        }

        .intro-image-float.left {
            float: left;
            margin: 0 20px 20px 0;
        }
        
        .card-image img {
            max-width: 100%;
            height: auto;
            object-fit: contain;
            display: block;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .intro-main-definition {
            font-size: 1.2em;
            line-height: 1.8;
            margin-bottom: 30px;
            color: var(--text-main);
        }

        #intro h4 {
            font-size: 1.5em;
            margin-top: 30px;
            margin-bottom: 15px;
            color: var(--primary);
            border-bottom: 2px solid var(--blue1);
            padding-bottom: 5px;
        }

        #intro ol,
        #intro ul {
            list-style-position: outside;
            margin-left: 25px;
            margin-bottom: 20px;
        }

        #intro li {
            font-size: 1.05em;
            line-height: 1.7;
            margin-bottom: 12px;
        }

        #intro li strong {
            color: var(--primary);
        }
        
        #intro ul ul {
            margin-left: 20px;
            margin-top: 8px;
            list-style-type: disc;
        }

        #intro ul ul li {
            font-size: 0.95em;
            line-height: 1.6;
            margin-bottom: 8px;
            color: var(--text-secondary);
        }

        .attacks-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: var(--blue3);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .attacks-table th {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
        }

        .attacks-table td {
            padding: 15px;
            border-bottom: 1px solid var(--blue1);
            color: var(--text-secondary);
        }
        [data-theme="dark"] .attacks-table td {
             color: var(--text-main);
        }

        .attacks-table tr:hover {
            background-color: var(--blue2);
        }
        [data-theme="dark"] .attacks-table tr:hover {
            background-color: var(--blue1);
        }

        .threat-level {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: bold;
            color: var(--text-main);
        }

        .threat-low { background: #c8e6c9; color: #2e7d32; }
        .threat-moderate { background: #fff9c4; color: #fbc02d; }
        .threat-high { background: #ffccbc; color: #d84315; }
        .threat-critical { background: #ffcdd2; color: #c62828; }

        .key-differences {
            background: var(--blue2);
            border-left: 4px solid var(--primary);
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 10px 10px 0;
            color: var(--text-secondary);
        }

        .key-differences h4 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .key-differences ol {
            margin-left: 20px;
        }

        .key-differences li {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .review-questions-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .question {
            background: var(--blue2);
            color: var(--text-main);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .question:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }

        .question-title {
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1.1em;
            display: flex;
            justify-content: space-between;
            align-items: center;
            text-shadow: 0 1px 4px rgba(0,0,0,0.08);
        }

        .question-title .arrow-icon {
            transition: transform 0.3s ease;
        }

        .question.active .arrow-icon {
            transform: rotate(180deg);
        }

        .question-answer {
            color: var(--text-secondary);
            max-height: 0;
            overflow: hidden;
            padding-top: 0;
            margin-top: 0;
            border-top: 1px solid var(--blue1);
            transition: max-height 0.4s ease-out, padding-top 0.4s ease-out, margin-top 0.4s ease-out;
        }

        .question.active .question-answer {
            max-height: 500px;
            padding-top: 15px;
            margin-top: 15px;
        }

        .highlight {
            background: linear-gradient(120deg, var(--secondary) 0%, var(--accent) 100%);
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
            color: var(--text-main);
        }

        .rsa-section {
            padding: 20px;
            background: var(--blue1);
            border-radius: 15px;
        }

        .rsa-section h3 {
            text-align: center;
            font-size: clamp(1.6em, 4vw, 2em);
            color: var(--primary);
            margin-bottom: 25px;
        }

        .rsa-image-container {
            display: flex;
            flex-direction: column;
            gap: 25px;
            align-items: center;
            justify-content: center;
        }

        .rsa-image-wrapper {
            width: 100%;
            max-width: 900px; /* Adjust max-width as needed */
            background: var(--section-bg);
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow);
            text-align: center;
        }
        
        .rsa-image-wrapper img {
             width: 100%;
             height: auto;
             max-height: 450px;
             object-fit: contain;
        }

        .rsa-image-wrapper p {
            margin-top: 15px;
            font-size: 1em;
            color: var(--text-secondary);
            font-style: italic;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: var(--blue1);
            border-radius: 3px;
            margin: 20px auto 0 auto;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.3s ease;
        }

        footer {
            text-align: center;
            padding: 20px;
            margin-top: 20px;
            color: white;
            font-size: 0.9em;
            background: var(--footer-bg);
            border-radius: 15px 15px 0 0;
        }
        
        .large-centered-image {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px auto;
        }

        /* Theme Toggle Switch */
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 30px;
            z-index: 10;
        }
        .toggle-switch {
            width: 56px;
            height: 28px;
            background: var(--blue1);
            border-radius: 20px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            transition: left 0.3s cubic-bezier(.4,2,.6,1), background 0.3s;
            box-shadow: 0 1px 4px rgba(0,0,0,0.10);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1em;
            color: var(--primary);
            overflow: hidden;
        }
        .toggle-slider .icon-sun,
        .toggle-slider .icon-moon {
            position: absolute;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .toggle-slider .icon-sun { color: #FFD700; }
        .toggle-slider .icon-moon { color: var(--primary); }
        .toggle-switch:not(.dark) .icon-sun { opacity: 1; }
        .toggle-switch.dark .icon-moon { opacity: 1; }
        .toggle-switch.dark { background: var(--primary); }
        .toggle-switch.dark .toggle-slider {
            left: 31px;
            background: var(--blue3);
            color: var(--primary);
        }
        
        .download-section-btn {
            background: var(--accent);
            color: var(--text-main);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            box-shadow: 0 2px 8px rgba(0,0,0,0.10);
            cursor: pointer;
            transition: background 0.2s, transform 0.2s;
        }
        .download-section-btn:hover {
            background: var(--secondary);
            transform: scale(1.1);
        }
        
        .copyright-btn {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin: 10px 0 0;
        }

        .copyright-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--section-bg);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            max-width: 380px;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s, visibility 0.5s, bottom 0.5s;
        }

        .notification.show {
            opacity: 1;
            visibility: visible;
            bottom: 30px;
        }

        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .notification-title {
            font-weight: bold;
            color: var(--primary);
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .notification-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.2em;
        }
        
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(224, 247, 250, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        [data-theme="dark"] .loading-screen {
            background: rgba(34, 47, 62, 0.8);
        }
        .loading-screen.show {
            opacity: 1;
            visibility: visible;
        }
        .loading-spinner {
            border: 8px solid rgba(0, 0, 0, 0.1);
            border-top: 8px solid var(--primary);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        .loading-text {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--text-main);
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Nav Dropdown for Mobile */
        .nav-dropdown-container {
            display: none;
            width: 100%;
            padding: 0 10px;
        }
        .nav-dropdown {
            width: 100%;
            padding: 12px 20px;
            border-radius: 25px;
            border: 1px solid var(--blue1);
            background: var(--section-bg);
            color: var(--text-main);
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg fill="currentColor" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>');
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 20px;
            box-shadow: var(--shadow);
        }

        .screenshot-ready * {
            transition: none !important;
        }
        .screenshot-hide {
            display: none !important;
        }
        
        /* Responsive Styles */
        @media (max-width: 900px) {
            .intro-image-float {
                max-width: 100%;
                float: none;
                margin: 20px auto;
            }
        }
        
        @media (max-width: 768px) {
            .nav-buttons {
                display: none;
            }
            .nav-dropdown-container {
                display: block;
            }
            .navigation {
                padding: 10px;
            }
            .attacks-table {
                display: block;
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-spinner"></div>
        <p class="loading-text">Preparing your content...</p>
    </div>

    <div class="container">
        <div class="header">
            <div class="theme-toggle">
                <div class="toggle-switch" id="themeSwitch">
                    <div class="toggle-slider">
                        <span class="icon-sun"><i class="fas fa-sun"></i></span>
                        <span class="icon-moon"><i class="fas fa-moon"></i></span>
                    </div>
                </div>
            </div>
            <h1><i class="fas fa-shield-alt"></i> Data Security Learning Module</h1>
            <p>Digital Signatures</p>
            <p>Created By Eng. Eslam Osama</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>
            <div class="download-buttons">
                <button class="download-btn" onclick="downloadOriginalFile()">
                    <i class="fas fa-file-pdf"></i> Download Original Sheet
                </button>
                <button class="download-btn" onclick="downloadFullPageZip()">
                    <i class="fas fa-file-archive"></i> Download All Sections (ZIP)
                </button>
            </div>
        </div>

        <div class="navigation">
            <div class="nav-buttons">
                <button class="nav-btn active" data-section="intro"><i class="fas fa-book-open"></i> Introduction</button>
                <button class="nav-btn" data-section="attacks"><i class="fas fa-user-secret"></i> Attacks & Forgeries</button>
                <button class="nav-btn" data-section="differences"><i class="fas fa-cogs"></i> Key Differences</button>
                <button class="nav-btn" data-section="forgery-types"><i class="fas fa-mask"></i> Forgery Types</button>
                <button class="nav-btn" data-section="rsa"><i class="fas fa-key"></i> RSA Scheme</button>
                <button class="nav-btn" data-section="questions"><i class="fas fa-question-circle"></i> Review Questions</button>
            </div>
            <div class="nav-dropdown-container">
                <select id="navDropdown" class="nav-dropdown">
                    <option value="intro">Introduction</option>
                    <option value="attacks">Attacks & Forgeries</option>
                    <option value="differences">Key Differences</option>
                    <option value="forgery-types">Forgery Types</option>
                    <option value="rsa">RSA Scheme</option>
                    <option value="questions">Review Questions</option>
                </select>
            </div>
        </div>

        <div id="intro" class="section active">
            <h2 class="section-title">
                <span><i class="fas fa-book-open"></i> Introduction to Digital Signatures</span>
                <button class="download-section-btn" onclick="downloadSectionPng(this)"><i class="fas fa-download"></i></button>
            </h2>
            <p class="intro-main-definition"><strong>Digital Signature</strong> is a cryptographic technique that verifies the <span class="highlight">authenticity</span>, <span class="highlight">integrity</span>, and <span class="highlight">origin</span> of a digital message or document. It is created using the sender's <span class="highlight">private key</span> and verified using their <span class="highlight">public key</span>.</p>
            
            <div class="image-placeholder intro-image-float">
                <div class="card-image">
                       <img src="media/image1.png" alt="Simplified Depiction of Digital Signature Process">
                </div>
            </div>

            <h4>Key Features of Digital Signatures</h4>
            <ol>
                <li><strong>Authenticity:</strong> Confirms the message is from the claimed sender (verified via public key).</li>
                <li><strong>Integrity:</strong> Ensures the message hasn't been altered; any change breaks the signature.</li>
                <li><strong>Non-repudiation:</strong> The sender cannot deny sending the message after signing it.</li>
            </ol>

            <h4>Important Notes:</h4>
            <ul>
                <li><strong>Third-Party Authentication in Digital Signatures</strong><br>
                    A digital signature must be publicly verifiable, meaning a trusted third party can check its validity — not just the sender and receiver. This is often done using a Certificate Authority (CA).
                </li>
                <li><strong>Signatures Are Not Unconditionally Secure</strong><br>
                    Digital signatures are not 100% secure. An attacker might eventually break the algorithm, exploit weak random number generators, or use forgery attacks. Expiration dates help reduce this risk over time.
                </li>
            </ul>

            <div class="image-placeholder large-centered-image">
                <div class="card-image">
                       <img src="media/image2.png" alt="Obtaining certificates from Certificate Authority">
                </div>
            </div>
            <div style="clear: both;"></div>
        </div>

        <div id="attacks" class="section">
            <h2 class="section-title">
                <span><i class="fas fa-user-secret"></i> Attacks and Forgeries</span>
                <button class="download-section-btn" onclick="downloadSectionPng(this)"><i class="fas fa-download"></i></button>
            </h2>
            <p><strong>Scenario:</strong> Assume <span class="highlight">Alice is a server that runs an automated document-signing service</span>. An attacker, Mallory, wants to forge Alice's signature.</p>
            
            <div style="overflow-x:auto;">
                <table class="attacks-table">
                    <thead>
                        <tr>
                            <th>Attack Type</th>
                            <th>What the Attacker Does</th>
                            <th>What the Attacker Knows</th>
                            <th>Threat Level</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Key-only Attack</strong></td>
                            <td>Tries to forge a signature knowing only Alice's public key.</td>
                            <td>Public Key only</td>
                            <td><span class="threat-level threat-low">Low</span></td>
                        </tr>
                        <tr>
                            <td><strong>Known Message Attack</strong></td>
                            <td>Uses a set of valid signed documents to help forge a new one.</td>
                            <td>Public Key + Some (message, signature) pairs</td>
                            <td><span class="threat-level threat-moderate">Moderate</span></td>
                        </tr>
                        <tr>
                            <td><strong>Generic Chosen Message</strong></td>
                            <td>Gets signatures on a prepared list of messages to find a vulnerability.</td>
                            <td>Prepared message list (before any interaction)</td>
                            <td><span class="threat-level threat-moderate">Moderate</span></td>
                        </tr>
                        <tr>
                            <td><strong>Directed Chosen Message</strong></td>
                            <td>Chooses messages to be signed after seeing Alice's public key to tailor the attack.</td>
                            <td>Public Key + Chooses messages after seeing it</td>
                            <td><span class="threat-level threat-high">High</span></td>
                        </tr>
                        <tr>
                            <td><strong>Adaptive Chosen Message</strong></td>
                            <td>Sends messages sequentially, adjusting each new message based on the last signature received.</td>
                            <td>Public Key + Can adapt messages mid-attack</td>
                            <td><span class="threat-level threat-critical">Critical</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="differences" class="section">
            <h2 class="section-title">
                <span><i class="fas fa-cogs"></i> Key Differences Between Attack Types</span>
                <button class="download-section-btn" onclick="downloadSectionPng(this)"><i class="fas fa-download"></i></button>
            </h2>
            
            <div class="key-differences">
                <h4>🔍 Generic Chosen vs. Known Message Attack</h4>
                <ol>
                    <li>In <strong>Generic</strong>, the attacker chooses the messages. In <strong>Known</strong>, the attacker only observes existing signed messages.</li>
                </ol>
            </div>

            <div class="key-differences">
                <h4>🎯 Generic vs. Directed Chosen Message Attack</h4>
                <ol>
                    <li>In <strong>Generic</strong>, messages are chosen before knowing the public key. In <strong>Directed</strong>, they are chosen after, allowing for a more targeted attack.</li>
                </ol>
            </div>

            <div class="key-differences">
                <h4>🔄 Adaptive vs. Directed Chosen Message Attack</h4>
                <ol>
                    <li>In <strong>Directed</strong>, all messages are chosen at once. In <strong>Adaptive</strong>, the attacker dynamically adjusts the next message based on the signature from the previous one.</li>
                </ol>
            </div>
        </div>

        <div id="forgery-types" class="section">
            <h2 class="section-title">
                <span><i class="fas fa-mask"></i> Forgery Types</span>
                <button class="download-section-btn" onclick="downloadSectionPng(this)"><i class="fas fa-download"></i></button>
            </h2>
            
            <div style="overflow-x:auto;">
                <table class="attacks-table">
                    <thead>
                        <tr>
                            <th>Forgery Type</th>
                            <th>What It Means</th>
                            <th>Threat Level</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Total Break</strong></td>
                            <td>Attacker recovers the signer's private key and can sign anything.</td>
                            <td><span class="threat-level threat-critical">Critical</span></td>
                        </tr>
                        <tr>
                            <td><strong>Universal Forgery</strong></td>
                            <td>Attacker can forge a signature for any document without the key.</td>
                            <td><span class="threat-level threat-critical">Critical</span></td>
                        </tr>
                        <tr>
                            <td><strong>Selective Forgery</strong></td>
                            <td>Attacker forges a signature for a specific, pre-chosen message.</td>
                            <td><span class="threat-level threat-high">High</span></td>
                        </tr>
                        <tr>
                            <td><strong>Existential Forgery</strong></td>
                            <td>Attacker forges a signature for at least one arbitrary message (not chosen by them).</td>
                            <td><span class="threat-level threat-low">Low</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <div id="rsa" class="section">
             <h2 class="section-title">
                 <span><i class="fas fa-key"></i> RSA Signature Scheme</span>
                 <button class="download-section-btn" onclick="downloadSectionPng(this)"><i class="fas fa-download"></i></button>
            </h2>
            <div class="rsa-section">
                <h3>Direct Digital Signature with RSA</h3>
                <div class="rsa-image-container">
                    <div class="rsa-image-wrapper">
                        <img src="media/image3.png" alt="RSA Digital Signature Process Diagram">
                        <p>This diagram shows the core process of signing a message with a private key and verifying it with the corresponding public key.</p>
                    </div>
                    <div class="rsa-image-wrapper">
                        <img src="media/image4.png" alt="RSA Signature Implementation for Confidentiality">
                        <p>For confidentiality, the signed message can be further encrypted, ensuring only the intended recipient can read it.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="questions" class="section">
            <h2 class="section-title">
                <span><i class="fas fa-question-circle"></i> Review Questions</span>
                <button class="download-section-btn" onclick="downloadSectionPng(this)"><i class="fas fa-download"></i></button>
            </h2>
            <div class="review-questions-container">
                <div class="question" onclick="toggleAnswer(this)">
                    <div class="question-title">(1) What are two common disputes in message authentication? <i class="fas fa-chevron-down arrow-icon"></i></div>
                    <div class="question-answer">
                        A: The sender denies sending the message (non-repudiation), or the receiver claims the message was altered after signing (integrity).
                    </div>
                </div>

                <div class="question" onclick="toggleAnswer(this)">
                    <div class="question-title">(2) What are the essential properties of a digital signature? <i class="fas fa-chevron-down arrow-icon"></i></div>
                    <div class="question-answer">
                        A: Authenticity (verifies sender), Integrity (detects changes), and Non-repudiation (sender cannot deny).
                    </div>
                </div>

                <div class="question" onclick="toggleAnswer(this)">
                    <div class="question-title">(3) What requirements must a digital signature scheme satisfy? <i class="fas fa-chevron-down arrow-icon"></i></div>
                    <div class="question-answer">
                        A: It must be verifiable by third parties and computationally infeasible to forge a signature without the private key.
                    </div>
                </div>

                <div class="question" onclick="toggleAnswer(this)">
                    <div class="question-title">(4) What is the difference between direct and arbitrated digital signatures? <i class="fas fa-chevron-down arrow-icon"></i></div>
                    <div class="question-answer">
                        A: <strong>Direct:</strong> The receiver verifies the signature directly with the sender's public key. <strong>Arbitrated:</strong> A trusted third party (arbitrator) is involved in verifying signatures to resolve disputes.
                    </div>
                </div>
                
                <div class="question" onclick="toggleAnswer(this)">
                    <div class="question-title">(5) In what order should signing and encryption be applied? <i class="fas fa-chevron-down arrow-icon"></i></div>
                    <div class="question-answer">
                        A: <strong>Sign first, then encrypt.</strong> This ensures the signature applies to the original message content and can be verified by anyone after decryption.
                    </div>
                </div>

                <div class="question" onclick="toggleAnswer(this)">
                    <div class="question-title">(6) What are some threats to a direct digital signature scheme? <i class="fas fa-chevron-down arrow-icon"></i></div>
                    <div class="question-answer">
                        A: Key-only attacks, known message attacks, and various chosen message attacks (generic, directed, adaptive).
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>Data Security Learning Module - Digital Signatures | By Eng. Eslam Osama</p>
        <button class="copyright-btn" onclick="showCopyrightNotice()">
            <i class="fas fa-copyright"></i> All Rights Reserved
        </button>
    </footer>

    <div class="notification" id="copyrightNotification">
        <div class="notification-header">
            <div class="notification-title"><i class="fas fa-shield-alt"></i> Copyright Notice</div>
            <button class="notification-close" onclick="hideCopyrightNotice()"><i class="fas fa-times"></i></button>
        </div>
        <p>This content is protected by copyright law. Unauthorized copying, distribution, or use is strictly prohibited.</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const themeSwitch = document.getElementById('themeSwitch');
            const root = document.documentElement;
            const progressBar = document.getElementById('progressBar');
            const navButtons = document.querySelectorAll('.nav-btn');
            const navDropdown = document.getElementById('navDropdown');
            const sections = document.querySelectorAll('.section');
            const questions = document.querySelectorAll('.question');
            
            // --- Theme Management ---
            function setTheme(mode) {
                if (mode === 'dark') {
                    root.setAttribute('data-theme', 'dark');
                    themeSwitch.classList.add('dark');
                } else {
                    root.removeAttribute('data-theme');
                    themeSwitch.classList.remove('dark');
                }
                localStorage.setItem('theme', mode);
            }

            themeSwitch.addEventListener('click', () => {
                const isDark = root.getAttribute('data-theme') === 'dark';
                setTheme(isDark ? 'light' : 'dark');
            });
            
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (savedTheme) {
                setTheme(savedTheme);
            } else if (prefersDark) {
                setTheme('dark');
            }

            // --- Navigation ---
            function showSection(sectionId) {
                sections.forEach(section => {
                    section.classList.remove('active');
                });
                const activeSection = document.getElementById(sectionId);
                if (activeSection) {
                    activeSection.classList.add('active');
                }
                
                navButtons.forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.section === sectionId);
                });
                if(navDropdown.value !== sectionId) {
                    navDropdown.value = sectionId;
                }
                updateProgressBar();
            }

            navButtons.forEach(btn => {
                btn.addEventListener('click', () => showSection(btn.dataset.section));
            });
            
            navDropdown.addEventListener('change', () => showSection(navDropdown.value));

            // --- Progress Bar ---
            function updateProgressBar() {
                const activeSection = document.querySelector('.section.active');
                if (!activeSection) return;

                const sectionIndex = Array.from(sections).indexOf(activeSection);
                const progress = (sectionIndex / (sections.length - 1)) * 100;
                progressBar.style.width = progress + '%';
            }
            
            // --- Accordion for Questions ---
            window.toggleAnswer = (element) => {
                element.classList.toggle('active');
            }

            // --- Copyright Notice ---
            window.showCopyrightNotice = () => {
                const notice = document.getElementById('copyrightNotification');
                notice.classList.add('show');
                setTimeout(() => notice.classList.remove('show'), 5000);
            };
            window.hideCopyrightNotice = () => {
                document.getElementById('copyrightNotification').classList.remove('show');
            };
            
            // --- Loading Screen ---
            const loadingScreen = document.getElementById('loadingScreen');
            function showLoading(message) {
                loadingScreen.querySelector('.loading-text').textContent = message;
                loadingScreen.classList.add('show');
            }
            function hideLoading() {
                loadingScreen.classList.remove('show');
            }

            // --- Download Functionality ---
            window.downloadOriginalFile = () => {
                window.open('assets/Digital_Sign_Sheet_9.pdf', '_blank');
            };

            async function prepareForCanvas(targetElement, show) {
                const elementsToToggle = targetElement.querySelectorAll('.question');
                const originalStates = new Map();

                if (show) {
                    document.body.classList.add('screenshot-mode');
                    elementsToToggle.forEach(el => {
                        originalStates.set(el, el.classList.contains('active'));
                        el.classList.add('active');
                    });
                     // Hide all download buttons and nav during capture
                    document.querySelectorAll('.download-section-btn, .download-btn, .navigation').forEach(b => b.classList.add('screenshot-hide'));

                } else {
                    document.body.classList.remove('screenshot-mode');
                    elementsToToggle.forEach(el => {
                        if (originalStates.has(el) && !originalStates.get(el)) {
                            el.classList.remove('active');
                        }
                    });
                    document.querySelectorAll('.download-section-btn, .download-btn, .navigation').forEach(b => b.classList.remove('screenshot-hide'));
                }
                
                await new Promise(r => setTimeout(r, 50)); // Allow DOM to update
            }

            window.downloadSectionPng = async (button) => {
                const section = button.closest('.section');
                showLoading('Generating Image...');
                
                await prepareForCanvas(section, true);
                
                try {
                    const canvas = await html2canvas(section, { 
                        scale: 2, 
                        useCORS: true,
                        backgroundColor: null 
                    });
                    const link = document.createElement('a');
                    link.download = `${section.id}.png`;
                    link.href = canvas.toDataURL('image/png', 1.0);
                    link.click();
                } catch (e) {
                    console.error("Error generating PNG:", e);
                    alert("Could not generate image.");
                } finally {
                    await prepareForCanvas(section, false);
                    hideLoading();
                }
            }

            window.downloadFullPageZip = async () => {
                showLoading('Generating ZIP file...');
                const zip = new JSZip();
                const sectionIds = ['intro', 'attacks', 'differences', 'forgery-types', 'rsa', 'questions'];

                for (const id of sectionIds) {
                    const section = document.getElementById(id);
                    if (!section) continue;

                    const wasActive = section.classList.contains('active');
                    if (!wasActive) section.classList.add('active');
                    
                    await prepareForCanvas(section, true);

                    try {
                        const canvas = await html2canvas(section, { 
                            scale: 2, 
                            useCORS: true,
                            backgroundColor: null
                        });
                        const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
                        zip.file(`${id}.png`, blob);
                    } catch(e) {
                        console.error(`Failed to capture section ${id}:`, e);
                    } finally {
                       await prepareForCanvas(section, false);
                       if (!wasActive) section.classList.remove('active');
                    }
                }
                
                showSection(navDropdown.value); 
                
                try {
                    const zipBlob = await zip.generateAsync({type:"blob"});
                    saveAs(zipBlob, "Digital_Signatures_Module.zip");
                } catch(e) {
                    console.error("Error generating ZIP:", e);
                    alert("Could not generate ZIP file.");
                } finally {
                    hideLoading();
                }
            };

            // Initial setup
            showSection('intro');
        });
    </script>
</body>
</html>
